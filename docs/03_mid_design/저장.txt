sequenceDiagram
    actor User_Registered
    participant Web_Server as 웹 서버
    participant Auth_Module as 사용자 인증 모듈
    participant Facade as 퍼사드
    participant Persistence as 데이터베이스(라이브러리)

    User_Registered->>Web_Server: 1. 저장 요청 (분석 결과 ID)
    note right of User_Registered: '검색' 후 결과 화면에서<br/>'저장' 버튼 클릭 시 에만

    Web_Server->>Auth_Module: 2. 사용자 세션 유효성 검증
    Auth_Module-->>Web_Server: 3. 검증 완료 (사용자 ID 반환)

    Web_Server->>Facade: 4. 분석 결과 저장 요청 (사용자 ID, 분석 결과 ID)
    Facade->>Persistence: 5. 라이브러리 중복 확인 요청 (사용자 ID, 분석 결과 ID)

    alt 아직 저장되지 않은 경우(분석 결과 ID 없음)
        Persistence-->>Facade: 6. 조회 결과 (저장 내역 없음)
        Facade->>Persistence: 7. 라이브러리에 정보 저장
        Persistence-->>Facade: 8. 저장 성공
        Facade-->>Web_Server: 9. 저장 성공 응답
        Web_Server-->>User_Registered: 10. "저장이 완료되었습니다."  
        else 이미 저장된 경우(분석 결과 ID 이미 존재)
        Persistence-->>Facade: 6a. 조회 결과 (저장 내역 있음)
        Facade-->>Web_Server: 9a. 저장 실패 응답 (사유: 중복)
        Web_Server-->>User_Registered: 10a. "이미 저장된 항목입니다."
    end